# プラン削除後、保存済みプランが表示されない問題

## 問題の概要
プラン削除後にページをリロードすると、PlanNameEditModalの管理タブで「保存されたプランはありません」と表示される。しかし、新規作成後に管理タブを参照すると、保存されていたはずのプランが復活する。

## 原因分析

### 1. データ取得元の不一致
- PlanNameEditModalは`getAllPlans()`を使用してローカルストレージからプランを取得している
- しかし、現在のアプリケーションはFirestoreを使用してプランを管理している
- ローカルストレージは使用されていないため、常に空の配列が返される

### 2. 新規作成後にプランが表示される理由
- 新規作成時にPlanCoordinatorを通じてFirestoreにプランが作成される
- これによりplanListStoreが更新される
- しかし、PlanNameEditModalはplanListStoreの変更を監視していないため、表示が更新されない

### 3. Firestoreインデックスエラーの影響
- ページリロード時にFirestoreのインデックスエラーが発生
- planListServiceNoSortにフォールバックするが、正常に動作している
- 実際の問題はデータ取得元の不一致

## 修正タスク

### タスク1: PlanNameEditModalでplanListStoreを使用するように修正
**優先度: 高**

**実装内容:**
1. PlanNameEditModalのuseEffectを修正し、planListStoreからプランリストを取得する
2. `getAllPlans()`の使用を削除し、`usePlanListStore().plans`を使用する
3. planListStoreの更新を監視し、リアルタイムで表示を更新する

**具体的な変更:**
```typescript
// 変更前
useEffect(() => {
  if (isOpen) {
    if (plan) {
      setName(plan.name);
      setSavedPlans(getAllPlans()); // ローカルストレージから取得
    } else {
      setActiveTab('manage');
    }
  }
}, [plan, isOpen]);

// 変更後
const planList = usePlanListStore((state) => state.plans);

useEffect(() => {
  if (isOpen) {
    if (plan) {
      setName(plan.name);
    } else {
      setActiveTab('manage');
    }
    // planListStoreからプランを設定
    setSavedPlans(planList);
  }
}, [plan, isOpen, planList]);
```

### タスク2: ローカルストレージ関連の処理を削除
**優先度: 中**

**実装内容:**
1. PlanNameEditModalから`getAllPlans`のインポートを削除
2. 関連するローカルストレージ処理を削除
3. Firestoreベースの処理に統一

### タスク3: Firestoreインデックスの作成
**優先度: 低**

**実装内容:**
1. コンソールに表示されているURLにアクセスしてインデックスを作成
2. これによりplanListServiceが正常に動作するようになる
3. パフォーマンスの向上が期待できる

## テスト項目
1. プラン削除後、ページをリロードしても既存のプランが表示されることを確認
2. 新規作成、削除、更新がリアルタイムで反映されることを確認
3. 複数のタブ/ウィンドウで同期が取れることを確認