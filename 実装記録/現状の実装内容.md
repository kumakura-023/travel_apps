# 旅行計画Webアプリ - 現状の実装内容

## 使っている技術スタック

### フロントエンド技術
- **React 18**: UIフレームワーク
- **TypeScript**: 型安全な開発環境
- **Vite**: 高速ビルドツール・開発サーバー
- **Tailwind CSS**: ユーティリティファーストCSSフレームワーク

### 地図・API関連
- **Google Maps JavaScript API**: 地図表示とインタラクション
- **@react-google-maps/api**: ReactでのGoogle Maps統合
- **Places API**: 地点検索とオートコンプリート
- **Directions API**: ルート検索と移動時間計算

### 状態管理・ユーティリティ
- **Zustand**: 軽量グローバル状態管理
- **React Icons**: アイコンライブラリ
- **UUID**: ユニークID生成
- **LocalStorage**: データ永続化

### 開発・ビルド環境
- **ESLint + TypeScript**: コード品質管理
- **PostCSS**: CSS処理
- **PWA対応**: Webアプリマニフェスト

## 機能の概要

### 実装済み機能（Step 1-5相当）

#### 1. 基本地図機能
- **フルスクリーン地図表示**: Google Maps風のレイアウト
- **インタラクティブ操作**: ズーム、ドラッグ、マウスホイール対応
- **レスポンシブデザイン**: デスクトップ・タブレット・モバイル対応
- **地図スタイル**: 標準・衛星・地形表示切り替え

#### 2. 地点検索・追加機能
- **Places Autocomplete**: リアルタイム地点検索
- **候補地保存**: 検索した地点を旅行候補として登録
- **カテゴリ分類**: ホテル・レストラン・観光地・ショッピング・交通・その他
- **カスタムマーカー**: カテゴリ別のカラフルなアイコン表示

#### 3. 地点情報管理
- **地点詳細パネル**: レスポンシブ対応の詳細情報表示
  - デスクトップ: 右サイドパネル（540px幅）
  - タブレット: ボトムシート（50%高さ）
  - モバイル: フルスクリーンモーダル
- **編集可能情報**: 地点名・メモ・予想費用・カテゴリ
- **自動保存**: リアルタイム保存機能

#### 4. 移動時間・ルート機能
- **2地点間移動時間表示**: Ctrl+クリック（PC）・長押し（モバイル）で地点選択
- **ルート検索**: 出発地・目的地設定とルート表示
- **移動手段選択**: 徒歩・車・電車対応
- **視覚的ルート表示**: マゼンタピンク色の高視認性ルート

#### 5. 統合UI/UX機能
- **PlaceCircle統合オーバーレイ**: 地点情報・操作ボタンを一元化
- **出発地・目的地設定ボタン**: ワンクリックでルート検索開始
- **キーボードショートカット**: Ctrl+F（検索）、Esc（クリア）等
- **タッチデバイス最適化**: モバイル操作に配慮したUI

## 背景・目的

### 開発背景
- **旅行計画の効率化**: 複数の候補地を地図上で視覚的に管理
- **移動時間の可視化**: 地点間の移動コストを事前に把握
- **直感的な操作**: Google Maps風のUXで学習コストを削減

### プロジェクト目的
- **ブラウザベースアプリ**: インストール不要、クロスプラットフォーム対応
- **オフライン対応準備**: PWA基盤で将来的なオフライン機能
- **スケーラブル設計**: Firebase等のクラウド統合に対応可能な設計

## コンポーネント設計

### アーキテクチャ原則
- **単一責任原則**: 各コンポーネントが明確な役割を持つ
- **インターフェース依存**: 抽象的なインターフェースに依存
- **疎結合設計**: 変更影響範囲を最小化

### 主要コンポーネント階層

```
App.tsx
├── Map.tsx                    # メイン地図コンポーネント
│   ├── PlaceCircle.tsx       # 候補地の円・オーバーレイ・マーカー統合
│   ├── PlaceLabel.tsx        # 地点ラベル（付箋）表示
│   ├── RouteDisplay.tsx      # ルート表示
│   ├── RouteMarkers.tsx      # ルート検索の出発地・目的地マーカー
│   ├── TravelTimeCircle.tsx  # 移動時間圏表示
│   └── LabelOverlay.tsx      # カスタムラベル
├── PlaceDetailPanel.tsx      # 地点詳細パネル（レスポンシブ）
├── RouteSearchPanel.tsx      # ルート検索パネル
├── SearchBar.tsx             # 地点検索バー
├── AddLabelToggle.tsx        # ラベル追加トグル
└── ConfirmDialog.tsx         # 確認ダイアログ
```

### 状態管理ストア

```typescript
// グローバル状態管理（Zustand）
placesStore.ts           # 候補地データ管理
placeStore.ts           # 選択中地点管理
routeSearchStore.ts     # ルート検索状態
routeConnectionsStore.ts # 2地点間移動時間
travelTimeStore.ts      # 移動時間圏設定
labelsStore.ts          # カスタムラベル
```

### サービス層

```typescript
// API・ビジネスロジック
directionsService.ts    # Directions API統合
bookingService.ts       # 予約サイト連携（準備）
```

### ユーティリティ

```typescript
categoryClassifier.ts   # Google Places APIタイプからカテゴリ分類
categoryIcons.ts       # カテゴリ別アイコン・色管理
formatCurrency.ts      # 通貨フォーマット
travelTimeCalculator.ts # 移動時間計算
```

## できること・制限事項

### ✅ 実装済み機能

#### 地点管理
- ✅ Google Places APIによる地点検索
- ✅ 候補地の保存・編集・削除
- ✅ カテゴリ分類と視覚的アイコン表示
- ✅ 地点詳細情報の管理（名前・住所・メモ・費用）
- ✅ LocalStorageでのデータ永続化

#### 地図操作
- ✅ 直感的な地図操作（ズーム・ドラッグ・マウスホイール）
- ✅ 地点のクリック・ホバー操作
- ✅ 複数地点の同時表示
- ✅ レスポンシブ対応（PC・タブレット・モバイル）

#### ルート・移動時間
- ✅ 2地点間のルート検索と表示
- ✅ 複数移動手段対応（徒歩・車・電車）
- ✅ 移動時間・距離の表示
- ✅ 視覚的なルート表示（高視認性）
- ✅ ルートの削除・管理

#### UI/UX
- ✅ Google Maps風の洗練されたデザイン
- ✅ Material Design準拠のコンポーネント
- ✅ キーボードショートカット対応
- ✅ 統合オーバーレイUI（PlaceCircle）
- ✅ ワンクリック出発地・目的地設定
- ✅ 候補地リスト表示 & コスト管理タブ
  - 検索・カテゴリフィルター・並び替え
  - コスト編集・総額/カテゴリ別集計
  - 円グラフ可視化

### ⚠️ 制限事項・未実装機能

#### データ管理
- ❌ 旅行計画の複数管理（現在は単一計画のみ）
- ❌ データのエクスポート・インポート機能
- ❌ クラウド同期（Firebase等）
- ❌ 計画の共有機能

#### 表示・UI
- ❌ 地点の並べ替え（ドラッグ&ドロップ）
- ❌ カテゴリフィルタリング（地図マーカーへの適用）

#### 移動時間機能
- ❌ 起点からの時間圏表示
- ❌ 複数地点の一括移動時間計算
- ❌ 移動時間のキャッシュ機能

#### アクセシビリティ・PWA
- ❌ 完全なキーボード操作対応
- ❌ スクリーンリーダー対応
- ❌ オフライン機能
- ❌ インストール可能PWA

## コンポーネント使用時のオプション

### Map.tsx
```typescript
interface MapProps {
  children?: React.ReactNode; // 追加のオーバーレイコンポーネント
}

// 使用例
<Map>
  <CustomOverlay />
</Map>
```

### PlaceCircle.tsx
```typescript
interface PlaceCircleProps {
  place: Place;        // 表示する地点データ
  zoom?: number;       // 現在のズームレベル（デフォルト: 14）
}

// 自動で以下を表示:
// - カテゴリ別マーカー
// - 情報オーバーレイ（ズーム12以上）
// - 出発地・目的地設定ボタン
// - 削除ボタン
```

### PlaceDetailPanel.tsx
```typescript
// グローバル状態から選択中地点を自動取得
// レスポンシブ対応：
// - デスクトップ: 540px固定幅サイドパネル
// - タブレット: 50%高さボトムシート  
// - モバイル: フルスクリーンモーダル
```

### RouteSearchPanel.tsx
```typescript
// グローバル状態で出発地・目的地管理
// 自動的にルート検索・表示
// デスクトップ: 480px固定幅サイドパネル
```

### カテゴリ設定
```typescript
// utils/categoryIcons.ts
export type PlaceCategory = 
  | 'hotel'      // ホテル（青）
  | 'restaurant' // レストラン（オレンジ）
  | 'sightseeing'// 観光地（緑）
  | 'shopping'   // ショッピング（紫）
  | 'transport'  // 交通（グレー）
  | 'other';     // その他（赤）
```

## 関連ファイル・ディレクトリ構造

### プロジェクト構造
```
travel_app/
├── public/
│   ├── index.html
│   └── manifest.webmanifest
├── src/
│   ├── components/          # UIコンポーネント
│   │   ├── Map.tsx         # メイン地図
│   │   ├── PlaceCircle.tsx # 地点表示統合コンポーネント
│   │   ├── PlaceDetailPanel.tsx # 地点詳細パネル
│   │   ├── RouteSearchPanel.tsx # ルート検索パネル
│   │   ├── SearchBar.tsx   # 検索バー
│   │   ├── RouteDisplay.tsx # ルート表示
│   │   ├── RouteMarkers.tsx # ルートマーカー
│   │   ├── TravelTimeCircle.tsx # 移動時間圏
│   │   ├── PlaceLabel.tsx  # 地点ラベル
│   │   ├── AddLabelToggle.tsx # ラベル追加
│   │   ├── LabelOverlay.tsx # ラベルオーバーレイ
│   │   ├── LabelEditDialog.tsx # ラベル編集
│   │   ├── ConfirmDialog.tsx # 確認ダイアログ
│   │   └── [削除] CustomMarker.tsx # 削除済み
│   ├── hooks/              # カスタムフック
│   │   ├── useGoogleMaps.ts # Google Maps統合
│   │   ├── useDirections.ts # Directions API
│   │   ├── useDeviceDetect.ts # デバイス検出
│   │   ├── useKeyboardShortcuts.ts # キーボード
│   │   ├── useMediaQuery.ts # レスポンシブ
│   │   └── useTravelTimeMode.ts # 移動時間モード
│   ├── store/              # 状態管理
│   │   ├── placesStore.ts  # 候補地管理
│   │   ├── placeStore.ts   # 選択地点管理
│   │   ├── routeSearchStore.ts # ルート検索状態
│   │   ├── routeConnectionsStore.ts # 地点間移動時間
│   │   ├── travelTimeStore.ts # 移動時間圏
│   │   └── labelsStore.ts  # カスタムラベル
│   ├── services/           # API・ビジネスロジック
│   │   ├── directionsService.ts # Directions API
│   │   └── bookingService.ts # 予約サイト連携
│   ├── types/              # 型定義
│   │   ├── index.ts        # 基本型定義
│   │   ├── booking.ts      # 予約関連型
│   │   ├── travelTime.ts   # 移動時間型
│   │   └── env.d.ts        # 環境変数型
│   ├── utils/              # ユーティリティ
│   │   ├── categoryClassifier.ts # カテゴリ分類
│   │   ├── categoryIcons.ts # アイコン管理
│   │   ├── formatCurrency.ts # 通貨フォーマット
│   │   └── travelTimeCalculator.ts # 移動時間計算
│   ├── App.tsx             # メインアプリ
│   ├── main.tsx           # エントリーポイント
│   └── index.css          # グローバルスタイル
├── package.json
├── tsconfig.json
├── tailwind.config.js
├── vite.config.ts
└── .env.example           # 環境変数例
```

### 重要なファイルとその役割

#### 状態管理の中核
- **placesStore.ts**: 候補地のCRUD操作、LocalStorage連携
- **routeSearchStore.ts**: ルート検索の状態管理、地点選択
- **placeStore.ts**: 現在選択中の地点情報管理

#### UI統合の要
- **PlaceCircle.tsx**: 地点表示・操作の統合コンポーネント
- **Map.tsx**: 全体レイアウト、マーカー・オーバーレイ管理
- **PlaceDetailPanel.tsx**: レスポンシブ地点詳細表示

#### API統合
- **directionsService.ts**: Google Directions APIの統合、エラーハンドリング
- **categoryClassifier.ts**: Google Places APIタイプの分類

## 注意点

### 1. API使用量・制限

#### Google Maps API
- **Places API**: 検索1回ごとに課金、オートコンプリート有料
- **Directions API**: ルート検索1回ごとに課金
- **推奨対策**: 
  - 検索結果のキャッシュ機能（未実装）
  - バッチ処理での効率化（一部実装）
  - ユーザーへの使用量表示（未実装）

#### API制限事項
- Directions API: 最大25waypoints（制限内）
- Places API: リクエスト頻度制限あり
- 商用利用時の追加ライセンス必要

### 2. ブラウザ・デバイス互換性

#### 対応ブラウザ
- ✅ Chrome（推奨）
- ✅ Firefox
- ✅ Safari
- ✅ Edge
- ❌ IE（非対応）

#### デバイス対応
- ✅ デスクトップ（1024px以上）
- ✅ タブレット（768px-1023px）
- ✅ モバイル（〜767px）
- ⚠️ 小画面デバイス（〜320px）では一部UI調整必要

#### タッチ操作
- ✅ タップ・スワイプ・ピンチズーム対応
- ✅ 長押しでの地点選択機能
- ⚠️ マルチタッチジェスチャーは限定的

### 3. パフォーマンス考慮事項

#### メモリ使用量
- **大量マーカー**: 100地点以上で描画負荷増加
- **対策**: マーカークラスタリング（未実装）、仮想化（未実装）

#### ネットワーク負荷
- **地図タイル**: Google Mapsが自動最適化
- **API呼び出し**: 現在はキャッシュなし（改善要）

#### バッテリー影響
- **GPS使用**: 現在位置取得機能で消費増加
- **レンダリング**: 複雑なオーバーレイで描画負荷

### 4. データ管理・プライバシー

#### データ保存
- **LocalStorage**: 5-10MB制限、ブラウザクリアで消失
- **代替案**: IndexedDB、クラウド同期（未実装）

#### プライバシー
- **位置情報**: ユーザー明示許可必要
- **検索履歴**: 現在は保存なし
- **GDPR対応**: 将来的に必要（EU向けサービス時）

### 5. 今後の拡張・保守

#### アーキテクチャ制約
- **単一責任原則**: 新機能追加時の影響範囲を限定
- **インターフェース依存**: Google Maps API変更への対応準備
- **状態管理**: Zustand→Redux等への移行可能性

#### 技術的負債
- **型安全性**: 一部Google Maps APIで`any`型使用
- **エラーハンドリング**: 包括的なエラー境界が不完全
- **テストカバレッジ**: 単体テスト・E2Eテスト未実装

#### スケーラビリティ
- **コンポーネント数**: 現在は管理可能な規模
- **状態管理**: 複雑化時はRedux Toolkit等検討
- **バンドルサイズ**: Tree shakingとCode splittingで最適化

### 6. 運用・デプロイ時の注意

#### 環境変数
```bash
# 必須設定
VITE_GOOGLE_MAPS_API_KEY=your_api_key_here

# 本番環境追加設定
VITE_APP_ENV=production
VITE_API_BASE_URL=https://api.example.com
```

#### ビルド設定
- **Vite設定**: チャンク分割で初期ロード最適化
- **PWA対応**: Service Worker、Manifest設定
- **SEO**: メタタグ、OGP設定（未完全）

#### セキュリティ
- **API Key制限**: HTTPリファラー制限設定
- **XSS対策**: React標準対策（DOMPurify追加検討）
- **HTTPS必須**: 位置情報API使用のため

この実装により、要件定義書Step 5相当までの機能が完成し、Google Maps品質のユーザーエクスペリエンスを提供する旅行計画Webアプリの基盤が確立されています。 